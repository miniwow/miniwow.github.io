<!DOCTYPE html>
<html>
<head>
  <title>Mini WoW</title>
  <meta charset="utf-8">
<style>

* {
  font-family: monospace;
  color: #f8f8f2;
  background: #282a36;
  font-size: 16px;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body { width: 100% }

h2 {
  font-size: 18px;
  color: #50fa7b;
}

input {
  width: 100%;
  padding: 0.25em 0.45em;
  border: 0;
  background: #1f212b;
  border-radius: 0.25em;
  margin: 0.5em 0;
  border: 1px solid black;
}

input:focus {
  color: #8be9fd;
  border-color:#8be9fd;
  outline: 0;
}

label b {
  margin-right: 1em;
  color: #f1fa8c;
}

label {
  display: flex;
  align-items: center;
}

form i {
  color: #6272a4;
  font-size: 12px;
}

form {
  flex-direction: column;
  max-width: 38ch;
  margin: 0 auto;
}

p {
  line-height: 1.75em;
  margin: 1em;
}

h2 { text-align: center }

hr:before {
  font-size: 12px;
  content: '•••••••••';
  letter-spacing: 2px;
  color: #6272a4;
  display: block;
}

hr {
  margin: 0.75em;
  text-align: center;
  color: transparent;
}

body > div {
  flex-direction: column;
  text-align: center;
}

#logo, #logo > pre { font-size: 32px }
#logo {
  margin: 32px auto;
  display: block;
  text-decoration: none;
  width: 12ch;
  text-align: center;
}

#welcome:before,
#success:before,
#already-taken:before,
#missing-session:before,
#invalid-login:before {
  content: ':(';
  display: block;
  font-size: 32px;
  transform: rotate(90deg);
  width: 2ch;
  margin: 1em auto;
}

#welcome:before,
#success:before { content: ':)' }

body > div,
body > form { display: flex }

body > div:not(:target),
body > form:not(:target) { display: none }

#register:target + #register-link,
#change-password:target + #change-password-link {
  color: #6272a4;
  text-decoration: none;
}

a {
  display: block;
  padding: 0.5em 0.75em;
  color: #ff79c6;
}

#register-link { top: 3em }
#change-password-link { top: 6em }
#change-password-link,
#register-link {
  position: fixed;
  right: 1em;
}

input[name=login] {
  border-radius: 0.25em 0 0 0.25em;
  border-right: 0;
}

#checker:after {
  display: block;
  content: '•';
  border-radius: 0 0.25em 0.25em 0;
  background: #14151c;
  padding: 0.25em 0.45em;
  border: 1px solid black;
  border-left: 0;
  color: transparent;
}

input[name=login]:focus + #checker:after {
  border-color: #8be9fd;
}

input[name=login] + #checker:after {
  color: #ff5555;
  content: '✗';
}

input[name=login].checking + #checker:after {
  color: #6272a4;
  content: '•';
}

input[name=login].valid + #checker:after {
  color: #50fa7b;
  content: '✔';
}

</style>
</head>
<body>
<a href="#home" id="logo"><pre>Mini...
.......
....WoW</pre></a>
<div id="already-taken">
  <p>Login already taken</p>
  <a href="#register">ok</a>
</div>
<div id="missing-session">
  <p>Missing session</p>
  <a href="#register">retry</a>
</div>
<div id="invalid-login">
  <p>Invalid Login</p>
  <a href="#register">ok</a>
</div>
<form
  id="register"
  method="POST"
  enctype="application/x-www-form-urlencoded"
  action="https://frosty-snowflake-73794.pktriot.net/authorize"
>
  <h2>Create your account</h2>
  <hr>
  <label>
    <b>login</b>
    <input type="text" name="login">
    <span id="checker"></span>
  </label>
  <i>
    Only Letters and numbers, no accents.
    Your login will be public and can't be changed
  </i>
  <label><b>password</b><input type="password" name="password"></label>
  <i>don't pick something stupid if you don't want to get hacked</i>
  <hr>
  <input type="submit" value="Create account and link discord">
  <i>
    A discord account is required to join
    but you can play without using discord
  </i>
</form>
<a id="register-link" href="#register">Register</a>
<form
  id="change-password"
  method="POST"
  enctype="application/x-www-form-urlencoded"
  action="https://frosty-snowflake-73794.pktriot.net/authorize"
>
  <h2>Change Password</h2>
  <hr>
  <label><b>New&nbspPassword</b><input type="password" name="password"></label>
  <hr>
  <input type="submit" value="Change your password">
</form>
<a id="change-password-link" href="#change-password">Change password</a>
<div id="welcome">
  <h2>Welcome !</h2>
  <p>You have joined to the server.
    <br>You can now look around in the discord and connect ingame</p>
  <a href="#home">ok</a>
</div>
<div id="success">
  <h2>The opperation was a success.</h2>
  <hr>
  <a href="#home">ok</a>
</div>
<div id="home">
  <i>A nice server</i>
</div>
</body>
<script>
addEventListener('hashchange', (function u() {
  const id = location.hash.slice(1)
  id && [...document.body.children].find(e => e.id === id)
  || document.getElementById('logo').click()
  return u
})())

// check login as you type
const baseURL = 'https://frosty-snowflake-73794.pktriot.net'
const loginInput = document.querySelector('input[name=login]')
const fetchLogin = async () => {
  const login = loginInput.value
  if (loginInput.previousValue === login) return
  loginInput.classList.remove('valid')
  loginInput.previousValue = login
  if (login.length < 3 || !/^[A-Za-z0-9]+$/.test(login)) return
  const res = await fetch(`${baseURL}/id?login=${login}`)
  const id = await res.text()
  if (loginInput.value !== login) return true // recheck
  loginInput.classList.toggle('valid', !id)
}

const check = () => {
  if (loginInput.classList.contains('checking')) return
  loginInput.classList.add('checking')
  requestAnimationFrame(() => fetchLogin()
    .finally(() => loginInput.classList.remove('checking'))
    .then(recheck => recheck && check()))
}

loginInput.onkeydown = check
loginInput.onchange = check
loginInput.onpaste = check

check()

</script>
</html>
